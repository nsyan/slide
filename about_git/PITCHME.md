# Gitの基本
2017新卒OJT

---

## まず伝えたいこと
- ブランチを切り替えるとローカルファイルが丸ごと変わるという現実
    - ファイルの状態による（`add`, `commit`)
- Gitこわくない
- 何かあった時は、無理して自分で解決しようとせずに相談（悪化する可能性が高い）

---

## なぜGitを使うのか
- バージョン（変更履歴）管理をしたい
    - いつ、何に、誰が、何をしたのか
- 複数人で同時に作業したい
- コードレビューを効率的にしたい（Gitホスティングサービスを利用）
    - マージリクエスト（GitLab）※弊社
    - プルリクエスト（GitHub, Bitbucket）  
    ※GitHubのアカウントがなければ作成

---

## 各バージョン管理システムのメリットとデメリット
- ファイルのコピーとリネーム（手動マンパワー）
- Subversion（集中型）
    - リポジトリが一つ（リモート）
- Git（分散型）
    - リポジトリが複数（リモート、ローカル）

---

### リポジトリとは
ファイルやディレクトリの状態を管理する場所（追加、変更、削除）
    - リモートリポジトリ：サーバに配置して複数人で共有
    - ローカルリポジトリ：各々がそれぞれのPCで使う

---

## 基本用語
- ブランチ  
履歴管理を枝分かれさせたもの。複数の履歴を並列に管理できる。
- クローン  
リモートリポジトリをコピーしてローカルリポジトリを作成（`clone`）
- チェックアウト  
ブランチやコミットを切り替える（`checkout`）
- フェッチ  
リモートリポジトリの最新の履歴の取得だけを行う（`fetch`）  
※ファイルの更新はしない
- プル（フェッチ＋マージ）  
リモートリポジトリの変更をローカルリポジトリに反映（`pull`）  
※ファイルが更新（マージ）される

---

- ワークツリー（ワーキングツリー）  
実際に作業しているファイルがある場所
- インデックス  
コミットしたいファイルを登録する場所（`add`）
- コミット  
インデックスに登録してある変更対象をローカルリポジトリに反映（`commit`）

---

- マージ
異なるブランチの変更を反映させる（`merge`）  
※お互いの変更履歴が残る。
- リベース  
異なるブランチの変更を反映させる（`rebase`）  
※変更履歴が片方に集約される（片方は消える）
- コンフリクト（衝突）  
マージ対象のファイルで同じ部分が変更されており、自動マージができない状態。
- プッシュ  
ローカルリポジトリの変更をリモートリポジトリに反映（`push`）

---

## Gitのメリット
- ローカルでブランチが気軽に切れる
    - 自分専用のブランチが持てる
    - ブランチ間のマージも容易
- ローカルコミットができる
    - 途中段階でもコミットできる
    - 他の開発者に影響を与えない
- ネットワークがなくても作業可能（ローカル）

---

## Gitクライアント
- [SourceTree](https://www.sourcetreeapp.com/)
- エディタやIDE
- ターミナル、[iTerm2](https://www.iterm2.com/)
- ターミナルとGUIツールの併用がオススメ

---

## ブランチモデル
- [A successful Git branching model（Git-flow）](http://nvie.com/posts/a-successful-git-branching-model/)
    - プロダクトを厳格にリリースする＝冗長すぎる場合も
    - マージの回数が増えがち＝取り込み忘れ、コンフリクト、確認、解消ミスの手間とリスクが増える
- [GitHub Flow](http://scottchacon.com/2011/08/31/github-flow.html)
    - masterと作業用のブランチの2種類のみ
    - masterは常にデプロイ可能という前提
- [GitLab Flow](https://about.gitlab.com/2014/09/29/gitlab-flow/)
    - masterは作業用、他にリリース準備用、デプロイ用のブランチがある
- 案件によってベースのモデルや細かいルールが違う（オリジナルの場合も）
- リリースをどう捉えるか

---

## 2種類のマージ
- Fast-Forward（マージの代わりに早送り）
- Non Fast-Forward（早送りではない普通のマージ）
- 常に、早送りではなく普通のマージをすべきだ論
- [こわくない Git](https://www.slideshare.net/kotas/git-15276118/40)

```
git config --global --add merge.ff false
git config --global --add pull.ff only
```

---

### Gitの設定ファイル
- `/Users/hoge/.gitconfig`
    - Gitの様々な設定
- gitignore  
意図的に追跡対象から外したい（無視したい）ファイルを設定するためのファイル
    - `/Users/hoge/.gitignore_global`: グローバル
    - `/Users/hoge/work/fuga/.gitignore`: ローカル

---

## マージとリベース
- こわくないマージ
- 使い方を間違えると怖いリベース
- なぜリベースではなくマージなのか
- [こわくない Git](https://www.slideshare.net/kotas/git-15276118/100)

---

## ケーススタディ

- ベーシックなフロー  
`clone, branch, checkout, status, add, commit, fetch, pull, push`
- マージとコンフリクトの解消: `merge`
- タグを付ける: `tag`
- 空コミットでコメント: `commit`
- ローカルの変更を無視: `update-index`
- ファイルを管理対象から外す: `rm`

---

- ローカルの変更を一時的に保存: `stash`
- ログを確認: `log`
- ヘッドの履歴を確認: `reflog`
- ブランチ間の差分を見る: `diff`
- ワークツリー・インデックスを元に戻す: `reset`
- 指定コミットを打ち消す: `revert`
- 特定のコミットのみ適用: `cherry-pick`

---

## その他

- コミットメッセージ
```
1行目：変更内容の要約（タイトル、概要）
2行目：空行
3行目以降：変更した理由（内容、詳細）なぜ
```
※案件によってはルールがある
- コミット粒度
- コードレビュー

---

## 課題
これからの各ジャンルの課題において、Gitで色々やってみましょう。
